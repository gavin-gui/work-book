
Redis与搜索热词推荐
---



### 摘要

本文解决一个非常普通的需求：在用户输入搜索关键词的过程中，系统给出搜索的推荐关键词。实现的方式还是通过redis，这次使用它5种数据结构中的zset，也就是有序集合。

### Redis的有序集合

关于有序集合不过多赘叙，先给出传送门：[Redsi有序集合][1]

在有序集合中，redis中某个key存储一个拥有多个value值得集合，并且集合中每个value都附带一个score，这个score是value的评分，有序集合中的value存储时按照score排序，这样效率屌屌的。

### 搜索热刺推荐

这个功能的样子很常见，在各大网站的搜索框中，当你输入关键词输入到一半的时候会推荐给你搜索热词。

在美团技术团队2014年的博客文章中也曾提到过此类实现，具体可参考美团博客文章[搜索引擎关键字智能提示的一种实现][2]



### 实现思路

一、简单的需求分析

对于一个搜索关键词的联想大抵分为几种情况，比如用户要搜索“北京雾霾”这样一个概念。

但是当他区搜索这个概念的时候，可能输入的是：

1. 拼音：beijingwumai、beijingwu
2. 首字母：bjwm、bj
3. 文字前缀：北京、北京雾
4. 文字相关：北京霾、霾、雾霾
5. 完整输入：北京雾霾

我们需要根据用户的输入区建立索引，从索引找到用户最坑的搜索意图。

对于Redis来讲，就要确立此去的key和value来建立索引



二、建立索引

在本文描述的实现思路里，索引的建立我们分为两步，这两部是衔接的：

1. 建立关键词指向搜索意图的索引
2. 建立关键词前缀指向关键词的索引


第一步，这里的关键词，就是一个搜索意图所包含的关键词，所以首先需要对搜索意图进行分词处理，比如北京雾霾这个搜索意图所包含的关键词是北京雾霾。这3个关键词我们需要建立3个key，这3个key都是 redis 中的有序集合key，都存储着一个集合，集合中的value就是搜索意图。为什么是个集合呢？很简单，因为一个关键词可能同时是不同搜索意图的关键词，比如`北京`这个关键词，除了是`北京雾霾`这个搜索意图的关键词，还可能是`北京下雪`这个搜索意图的关键词，所以，一个关键词会拥有一个有序集合key，这个key里存储了不同的搜索意图。 （这里可能有分词技术的瓶颈）




[1]:http://www.redis.cn/topics/data-types.html#sorted-sets
[2]:http://blog.jobbole.com/95802/2